
platform: linux/amd64

clone:
  git:
    image: syncloud/drone-git-amd64
    depth: 50

pipeline:
  version:
    image: syncloud/build-deps-amd64
    commands:
      - echo $DRONE_BUILD_NUMBER > version
      
  test:
    image: syncloud/build-deps-amd64
    commands:
      - pip install -e .
      - py.test
  
  deploy:
    image: syncloud/build-deps-amd64
    secrets: [PYPI_LOGIN, PYPI_PASSWORD]
    commands:
      - ./upload.sh